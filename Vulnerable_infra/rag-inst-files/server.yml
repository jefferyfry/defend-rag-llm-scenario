

write_files: 
  - path: /home/ubuntu/app/app.py
    owner: ubuntu:ubuntu
    permissions: "0644"
    encoding: base64
    content: ${content-app}
    defer: true
  - path: /home/ubuntu/app/requirements.txt
    owner: ubuntu:ubuntu
    permissions: "0644"
    encoding: base64
    content: ${content-req}
    defer: true
packages:
  - python3
  - python3-pip
  - jq
runcmd:
  - export WIZ_API_CLIENT_ID=${client_id} 
  - export WIZ_API_CLIENT_SECRET=${client_secret}
  - curl -L https://downloads.wiz.io/sensor/sensor_install.sh | sudo -E bash
  - cd /home/ubuntu/app
  - python3 -m venv venv
  - source venv/bin/activate
  - sudo apt remove python3-pip
  - wget https://bootstrap.pypa.io/get-pip.py
  - sudo python3 get-pip.py
  - pip3 install pyopenssl --upgrade
  - pip3 install chromadb
  - pip3 install flask
  - pip3 install blinker
  - pip3 install flask_cors
  - pip3 install llama_index
  - pip3 install llama_index.embeddings.huggingface
  - pip3 install llama_index.llms.ollama
  - pip3 install llama_index.vector_stores_chroma
  - pip3 install s3fs
  - pip3 install -r requirements.txt
  - echo 'Starting the app with the following parameters ${vectordb_ip} ${bucket_name}'
  - setsid python3 app.py ${vectordb_ip} ${bucket_name}